service: linklift-api

image: robfrank/linklift-api

servers:
  web:
    - <%= ENV["HOST_IP"] %>

proxy:
  ssl: false
  host: linklift-api.arcadebrain.ai
  app_port: 7070
  healthcheck:
    path: /up

# Credentials for your image host.
registry:
  # Specify the registry server, if you're not using Docker Hub
  server: ghcr.io
  username: robfrank

  # Always use an access token rather than real password (pulled from .kamal/secrets).
  password:
    - KAMAL_REGISTRY_PASSWORD

# Configure builder setup.
builder:
  arch: amd64
env:
  clear:
    JAVA_OPTS: "-Xmx2G -Dlinklift.arcadedb.host=linklift-arcadedb"
    LINKLIFT_OLLAMA_URL: "http://linklift-ollama:11434"
    LINKLIFT_OLLAMA_MODEL: "all-minilm:l6-v2"
    LINKLIFT_OLLAMA_DIMENSIONS: "384"

ssh:
  user: player

accessories:
  arcadedb:
    image: arcadedata/arcadedb-headless:26.2.2@sha256:da9d7870b136ba50a99f7cab2226cbb12f06017c930f86df97e31b2457493569
    host: <%= ENV["HOST_IP"] %>
    volumes:
      - /home/player/linklift/config:/home/arcadedb/config
      - /home/player/linklift/databases:/home/arcadedb/databases
      - /home/player/linklift/log:/home/arcadedb/log
    env:
      clear:
        JAVA_OPTS: "-Darcadedb.server.plugins=Postgres:com.arcadedb.postgres.PostgresProtocolPlugin"

  ollama:
    image: ollama/ollama:0.17.5@sha256:0f8a4ae495f59a719b278c82efb8c672c2123f90c18e4bff0be58acad69fbee0
    host: <%= ENV["HOST_IP"] %>
    port: 11434
    volumes:
      - /home/player/linklift/ollama:/root/.ollama
    cmd: serve
