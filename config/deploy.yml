service: linklift-api

image: robfrank/linklift-api

servers:
  web:
    - <%= ENV["HOST_IP"] %>

proxy:
  ssl: false
  host: linklift-api.arcadebrain.ai
  app_port: 7070
  healthcheck:
    path: /up

# Credentials for your image host.
registry:
  # Specify the registry server, if you're not using Docker Hub
  server: ghcr.io
  username: robfrank

  # Always use an access token rather than real password (pulled from .kamal/secrets).
  password:
    - KAMAL_REGISTRY_PASSWORD

# Configure builder setup.
builder:
  arch: amd64
env:
  clear:
    JAVA_OPTS: "-Xmx2G -Dlinklift.arcadedb.host=linklift-arcadedb"
    LINKLIFT_OLLAMA_URL: "http://linklift-ollama:11434"
    LINKLIFT_OLLAMA_MODEL: "all-minilm:l6-v2"
    LINKLIFT_OLLAMA_DIMENSIONS: "384"

ssh:
  user: player

accessories:
  arcadedb:
    image: arcadedata/arcadedb-headless:26.1.1@sha256:7d0f03428f9a7aaad4c7b585ddfe66c23846ff6a18b2b44afed3a7371a29b244
    host: <%= ENV["HOST_IP"] %>
    volumes:
      - /home/player/linklift/config:/home/arcadedb/config
      - /home/player/linklift/databases:/home/arcadedb/databases
      - /home/player/linklift/log:/home/arcadedb/log
    env:
      clear:
        JAVA_OPTS: "-Darcadedb.server.plugins=Postgres:com.arcadedb.postgres.PostgresProtocolPlugin"

  ollama:
    image: ollama/ollama:0.15.1@sha256:a58bce4506e3b81a9d63d649d69e3f26a28379b912ca00cf46c14d2496bc38dc
    host: <%= ENV["HOST_IP"] %>
    port: 11434
    volumes:
      - /home/player/linklift/ollama:/root/.ollama
    cmd: serve
